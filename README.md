# Syncplay定刻起動システム (with VLC Player)

指定された時刻にSyncplayクライアントを自動起動し、LAN内での同期動画再生を実現するシステムです。

## 概要

このシステムは、複数のPCで動画を同期再生するためのソリューションです。1台のPCがSyncplayサーバーを兼任し、各PCがクライアントとして接続することで、ネットワーク経由で動画の再生位置や再生/停止状態を同期します。

## 動作環境

- **SyncPlay**: v1.7.4 or later
- **VLC Player**: v3.0.21 or later
- **OS**: Windows 10 or 11

## システム構成図

```mermaid
---
config:
  theme: neo-dark
---
flowchart TD
 subgraph subGraph0["PC 1 (サーバー兼クライアント)"]
        A["ユーザー"]
        B("タスクスケジューラ")
        C{"バッチファイル"}
        D["Syncplay.exe"]
        E["VLC.exe"]
        F(("Syncplay Server"))
  end
 subgraph subGraph1["PC 2 (クライアント)"]
        G["ユーザー"]
        H("タスクスケジューラ")
        I{"バッチファイル"}
        J["Syncplay.exe"]
        K["VLC.exe"]
  end
    F -- "6.同期情報" --> D & J
    A -- "1.実行" --> C
    B -- "2.自動実行" --> C
    C -- "3.定刻になったら起動" --> D
    D -- "4.連携" --> E
    G -- "1.実行" --> I
    H -- "2.自動実行" --> I
    I -- "3.定刻になったら起動" --> J
    J -- "4.連携" --> K
    F -- "5.制御命令" --> D & J
    style F fill:#FFCDD2,stroke:#D50000,stroke-width:2px,color:#000000
```

## 処理の流れ

1. **バッチ実行**: 各PCでユーザーが手動、またはタスクスケジューラが自動でバッチファイルを実行します
2. **待機**: 両方のバッチファイルが、それぞれ指定された時刻まで待機します
3. **クライアント起動**: 指定時刻になると、両方のPCでSyncplayクライアント(`syncplayConsole.exe`)が起動します
4. **VLC連携**: Syncplayクライアントは、設定に基づいて自動でVLC (`vlc.exe`)と連携を開始します
5. **同期**: 両方のクライアントがLAN内のSyncplayサーバーに接続し、VLCでの再生位置や再生/停止状態を同期します

## 機能要件

| ID | 要件名 | 詳細 |
|---|---|---|
| FE-01 | **定刻起動機能** | 指定された時刻（時・分）になった際に、Syncplayのクライアント（Syncplay.exe）を起動する |
| FE-02 | **パラメータ設定機能** | バッチファイル内で以下の項目を容易に設定・変更できること<br>・Syncplayの実行ファイルパス<br>・起動時刻（HH:MM形式）<br>・**LAN内SyncplayサーバーのIPアドレス**<br>・ユーザー名、ルーム名<br>・再生する動画ファイルのパス |
| FE-03 | **待機処理機能** | バッチファイルを実行後、指定された時刻になるまで待機状態を維持する |
| FE-04 | **ステータス表示機能** | 待機中である旨をコマンドプロンプト上に表示し、ユーザーが進捗を把握できるようにする |

## 初期設定

この設定は、同期再生を行う**両方のPC**で必要になる箇所と、**サーバーPCのみ**で必要な箇所があります。

### ステップ1: サーバーPCのローカルIPアドレスを調べる（サーバーPCのみ）

まず、Syncplayサーバーを立てるPC（どちらか1台をサーバー役にします）のIPアドレスを確認します。

1. コマンドプロンプトを起動します
2. プロンプト上で `ipconfig` と入力し、自身のIPアドレスを確認します
3. 別機のコマンドプロンプトからそれぞれ`ping 192.168.*.*`を入力し、互いに通信が出来ているかを確認します
4. Pingが返ってこない場合はファイアウォールなどの設定を見直してください

### ステップ2: Syncplayサーバーを起動する（サーバーPCのみ）

次に、サーバーPCでSyncplayサーバープログラムを起動します。

1. Syncplayのインストールフォルダ（例: `C:\Program Files\Syncplay`）を開きます
2. `syncplay-server.exe` というファイルを見つけて、ダブルクリックで実行します
3. 「Windowsセキュリティの重要な警告」というファイアウォールの許可画面が表示されたら、**「プライベートネットワーク」にチェックが入っていることを確認**し、「アクセスを許可する」をクリックします
4. サーバー用の黒いウィンドウが起動すれば成功です

### ステップ3: VLCにSyncplay連携スクリプトを導入する（両方のPCで実施）

SyncplayがVLCを操作できるように、連携用のスクリプトをVLCの指定フォルダに配置します。

1. Syncplayのインストールフォルダを開きます
2. `resources\lua\intf` というサブフォルダの中に `syncplay.lua` というファイルがあるのを確認します
3. この `syncplay.lua` ファイルをコピーします
4. 次に、VLCのインストールフォルダを開きます（通常は `C:\Program Files\VideoLAN\VLC`）
5. `lua\intf` というサブフォルダに、先ほどコピーした `syncplay.lua` を貼り付けます
   - もし `intf` フォルダがなければ、`lua` フォルダの中に新しく作成してください

### ステップ4: 同期する動画ファイルを準備する（両方のPCで実施）

同期再生をスムーズに行うため、**2台のPCに全く同じ動画ファイル**を準備してください。ファイル名やファイルサイズが完全に一致している必要があります。

基本的に動画は`D:\Lemon\Documents\SyncPlay_AutoTimer\Video\` に設置してください。(連携スクリプト内でパスの変更が可能です)

### ステップ5: Syncplayクライアントの設定（両方のPCで実施）

一度、手動でSyncplayクライアントを起動し、VLCとの連携設定を行います。

1. `Syncplay.exe` を起動します
2. 設定画面で、**サーバーアドレスにステップ1で調べたサーバーPCのIPアドレス**（例: `192.168.1.10`）を入力します。ポート番号はデフォルトの `8999` のままで大丈夫です
3. ユーザー名とデフォルトルーム名を適当に決めます（両PCで同じルーム名を入力）
4. 「再生プレーヤーへのパス」の項目で、「VLC media player」の実行ファイル (`vlc.exe`) の場所を指定します
5. 設定を保存し、一度「準備完了」を押してサーバーに接続できることを確認してください

## 使用方法

初期設定完了後は、以下の手順で同期再生を開始できます：

1. 各PCで`run.bat`を実行 (Windowsタスクスケジューラーなどで自動起動するように設定してください)
2. 実行後、自動でSyncplayサーバが起動します
3. 指定時刻まで待機
4. 指定時刻に自動でSyncplayクライアントが起動し、同期再生が開始されます
5. 指定時間を過ぎると自動でビデオ再生アプリが停止します

## トラブルシューティング

- ファイアウォールでSyncplayの通信が遮断されていないか確認してください
- 両PCが同じネットワーク（LAN）に接続されていることを確認してください
- 動画ファイルが両PCで同じパス・同じファイルサイズであることを確認してください

## ライセンス

このプロジェクトで使用している外部ソフトウェアのライセンスに従ってください：
- Syncplay: Apache License 2.0
- VLC Media Player: GNU General Public License v2.0
